/*
 * jQuery 'Slidey' plug-in v.1.1
 * 
 * http://www.jcwd.com.au
 * @john0514
 *
 * Copyright 2011, John Cobb
 * Free for all to use, abuse and improve under the MIT license.
 * http://www.opensource.org/licenses/mit-license.php
 * 
 * August 2011
 */

(function(a){a.fn.slidey=function(b){var c={};var d={width:700,height:300,animation:"fade",animationDuration:450,automatic:true,rotationSpeed:4e3,hoverPause:true,showControls:true,centerControls:true,nextText:"Next",prevText:"Prev",showMarkers:true,centerMarkers:true,keyboardNav:true,useCaptions:true};c=a.extend({},d,b);var e=this;$slider=a("ul.slidey"),slides=$slider.children("li"),slideCount=slides.length,animating=false,paused=false,current=0,slidePosition=1,next=0,$active=slides.eq(current),forward="forward",back="backward";slides.css({height:c.height,width:c.width});$slider.css({height:c.height,width:c.width});e.css({height:c.height,width:c.width});if(c.showControls){$controlContainer=a('<ul class="slidey-controls"></ul>');$next=a('<li><a href="#" class="slidey-next" class="controls">'+c.nextText+"</a></li>");$previous=a('<li><a href="#" class="slidey-prev" class="controls">'+c.prevText+"</a></li>");$next.click(function(a){a.preventDefault();if(!animating)h(forward,false)});$previous.click(function(a){a.preventDefault();if(!animating)h(back,false)});$next.appendTo($controlContainer);$previous.appendTo($controlContainer);$controlContainer.appendTo(e);if(c.centerControls){$control=$next.children("a");offset=(e.height()-$control.height())/2;$next.children("a").css("top",offset).show();$previous.children("a").css("top",offset).show()}}if(c.showMarkers){$markerContainer=a('<ol class="slidey-markers"></ul>');a.each(slides,function(b,d){if(c.animType=="slide"){if(b!=0&&b!=slideCount-1)$marker=a('<li><a href="#">'+b+"</a></li>")}else{b++;$marker=a('<li><a href="#">'+b+"</a></li>")}$marker.click(function(c){c.preventDefault();if(!a(this).hasClass("active-marker")&&!animating)h(false,b)});$marker.appendTo($markerContainer)});markers=$markerContainer.children("li");markers.eq(current).addClass("active-marker");$markerContainer.appendTo(e);if(c.centerMarkers){offset=(c.width-$markerContainer.width())/2;$markerContainer.css("left",offset)}}if(c.keyboardNav){a(document).keyup(function(a){if(!paused){clearInterval(g);paused=true}if(!animating){if(a.keyCode==39){h(forward,false)}else if(a.keyCode==37){h(back,false)}}if(paused){g=setInterval(function(){h(forward)},c.rotationSpeed);paused=false}})}if(c.useCaptions){a.each(slides,function(b,c){var d=a(c);var e=d.children("img:first-child");var f=e.attr("alt");if(f){var g=a('<p class="slidey-caption">'+f+"</p>");g.appendTo(d)}})}if(c.hoverPause&&c.automatic){e.hover(function(){if(!paused){clearInterval(g);paused=true}},function(){if(paused){g=setInterval(function(){h(forward)},c.rotationSpeed);paused=false}})}if(c.animation=="slide"){$first=slides.eq(0);$last=slides.eq(slideCount-1);$first.clone().addClass("clone").removeClass("slide").appendTo($slider);$last.clone().addClass("clone").removeClass("slide").prependTo($slider);slides=$slider.children("li");slideCount=slides.length;$wrapper=a('<div class="slidey-wrapper"></div>').css({width:c.width,height:c.height,overflow:"hidden",position:"relative"});$slider.css({width:c.width*slideCount,left:-c.width});slides.css({"float":"left",position:"relative",display:"list-item"});$wrapper.prependTo(e);$slider.appendTo($wrapper)}var f=function(a){if(c.animation=="fade"){if(a==forward){!$active.next().length?next=0:next++}else if(a==back){!$active.prev().length?next=slideCount-1:next--}}if(c.animation=="slide"){if(a==forward){next=slidePosition+1}if(a==back){next=slidePosition-1}}return next};if(c.automatic){var g=setInterval(function(){h(forward,false)},c.rotationSpeed)}slides.eq(current).show();$slider.show();var h=function(a,b){if(!animating){if(a){next=f(a)}else if(b&&c.animation=="fade"){next=b-1}else{next=b}animating=true;if(c.animation=="fade"){markers.eq(current).removeClass("active-marker");markers.eq(next).addClass("active-marker");$next=slides.eq(next);$active.fadeOut(c.animationDuration);$next.fadeIn(c.animationDuration,function(){$active.hide();current=next;$active=$next;animating=false})}else if(c.animation=="slide"){markers.eq(slidePosition-1).removeClass("active-marker");if(next==slideCount-1){markers.eq(0).addClass("active-marker")}else if(next==0){markers.eq(slideCount-3).addClass("active-marker")}else{markers.eq(next-1).addClass("active-marker")}$slider.animate({left:-next*c.width},c.animationDuration,function(){if(next==0){slidePosition=slideCount-2;$slider.css({left:-slidePosition*c.width})}else if(next==slideCount-1){slidePosition=1;$slider.css({left:-c.width})}else{slidePosition=next}animating=false})}}};return this}})(jQuery)